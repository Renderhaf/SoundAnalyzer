<html>
<title>Sound Analyzer</title>
<body align="center">
	<script src="p5.js"></script>
	<script src="p5.sound.js"></script>

	<br><h2 id="freq">0</h2><br>
	<h2 id="note">C4</h2>
	<script>
		var notes = {"16.35": "C0", "17.32": "Db0", "18.35": "D0", "19.45": "Eb0", "20.6": "E0", "21.83": "F0", "23.12": "Gb0", "24.5": "G0", "25.96": "Ab0", "27.5": "A0", "29.14": "Bb0", "30.87": "B0", "32.7": "C1", "34.65": "Db1", "36.71": "D1", "38.89": "Eb1", "41.2": "E1", "43.65": "F1", "46.25": "Gb1", "49.0": "G1", "51.91": "Ab1", "55.0": "A1", "58.27": "Bb1", "61.74": "B1", "65.41": "C2", "69.3": "Db2", "73.42": "D2", "77.78": "Eb2", "82.41": "E2", "87.31": "F2", "92.5": "Gb2", "98.0": "G2", "103.83": "Ab2", "110.0": "A2", "116.54": "Bb2", "123.47": "B2", "130.81": "C3", "138.59": "Db3", "146.83": "D3", "155.56": "Eb3", "164.81": "E3", "174.61": "F3", "185.0": "Gb3", "196.0": "G3", "207.65": "Ab3", "220.0": "A3", "233.08": "Bb3", "246.94": "B3", "261.63": "C4", "277.18": "Db4", "293.66": "D4", "311.13": "Eb4", "329.63": "E4", "349.23": "F4", "369.99": "Gb4", "392.0": "G4", "415.3": "Ab4", "440.0": "A4", "466.16": "Bb4", "493.88": "B4", "523.25": "C5", "554.37": "Db5", "587.33": "D5", "622.25": "Eb5", "659.26": "E5", "698.46": "F5", "739.99": "Gb5", "783.99": "G5", "830.61": "Ab5", "880.0": "A5", "932.33": "Bb5", "987.77": "B5", "1046.5": "C6", "1108.73": "Db6", "1174.66": "D6", "1244.51": "Eb6", "1318.51": "E6", "1396.91": "F6", "1479.98": "Gb6", "1567.98": "G6", "1661.22": "Ab6", "1760.0": "A6", "1864.66": "Bb6", "1975.53": "B6", "2093.0": "C7", "2217.46": "Db7", "2349.32": "D7", "2489.02": "Eb7", "2637.02": "E7", "2793.83": "F7", "2959.96": "Gb7", "3135.96": "G7", "3322.44": "Ab7", "3520.0": "A7", "3729.31": "Bb7", "3951.07": "B7", "4186.01": "C8", "4434.92": "Db8", "4698.64": "D8", "4978.03": "Eb8"}

		var noteTolerance = 25;
		var mic, fft;
		mic = new p5.AudioIn();
		mic.start();
		fft = new p5.FFT(0,2048);
		fft.setInput(mic);

		function main(){
			spec = fft.analyze();
			max = 0;
			maxfreq = 0;
			for (var i = 0; i < 20000; i++){
				if (fft.getEnergy(i) > max){
					max = fft.getEnergy(i);
					maxfreq = i;
				}
			}
			document.getElementById("freq").innerHTML = "Frequency : " + maxfreq + " , Power : " + max;

			for (var i = 0 ; i < 100; i++){
				if (maxfreq > Object.keys(notes)[i] - noteTolerance && maxfreq < Object.keys(notes)[i] + noteTolerance){
					document.getElementById("note").innerHTML = notes[Object.keys(notes)[i]];
					break;
				}
			}

			window.requestAnimationFrame(main);
		}
		window.requestAnimationFrame(main);
	</script>
</body>
</html>
